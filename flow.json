{
  "description": "RRF OFA SMS",
  "states": [
    {
      "name": "Trigger",
      "type": "trigger",
      "transitions": [
        {
          "next": "splitFoodorComida",
          "event": "incomingMessage"
        },
        {
          "event": "incomingCall"
        },
        {
          "next": "sendEnglishOutgoing",
          "event": "incomingRequest"
        }
      ],
      "properties": {
        "offset": {
          "x": 1110,
          "y": -950
        }
      }
    },
    {
      "name": "sendNoThanks",
      "type": "send-message",
      "transitions": [
        {
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": 300,
          "y": 570
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "No problem. I won't contact you again! You can text the word 'FOOD' at any time if you would like to get information."
      }
    },
    {
      "name": "askEnglishLanguage",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "splitAllLanguages",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": 1030,
          "y": 220
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "What language would you prefer to receive these messages in?\n\n1. English\n2. Spanish",
        "timeout": "3600"
      }
    },
    {
      "name": "sendIncomingEnglishWelcome",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "splitEnglish",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -380,
          "y": -370
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Hi there, I'm Boston's Office of Food Access ChatBot.  Would you like to continue in English? Please respond YES, NO, or STOP.",
        "timeout": "3600"
      }
    },
    {
      "name": "languageEnglish",
      "type": "set-variables",
      "transitions": [
        {
          "next": "askLearnAbout",
          "event": "next"
        }
      ],
      "properties": {
        "variables": [
          {
            "value": "English",
            "key": "language"
          }
        ],
        "offset": {
          "x": -490,
          "y": 250
        }
      }
    },
    {
      "name": "errorEnglish",
      "type": "send-message",
      "transitions": [
        {
          "next": "sendIncomingEnglishWelcome",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -880,
          "y": -90
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Sorry, that option is not currently supported. Please try again."
      }
    },
    {
      "name": "askLearnAbout",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "splitLearnAbout",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -350,
          "y": 1220
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "What type of resources are you looking to learn more about?\n\n1. Benefit Programs \n2. Where to Pick Up Food\n3. Get Food Delivered\n\nI can only respond to one option at a time, but we will be able to come back to these options later. Please respond with 1, 2 or 3.",
        "timeout": "3600"
      }
    },
    {
      "name": "splitLearnAbout",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "errorLearnAbout",
          "event": "noMatch"
        },
        {
          "next": "askBenefit",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value matches_any_of 1, Benefit Programs, Benefits",
              "arguments": [
                "{{widgets.askLearnAbout.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, Benefit Programs, Benefits"
            }
          ]
        },
        {
          "next": "askPickup",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to 2, ",
              "arguments": [
                "{{widgets.askLearnAbout.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "2, Pickup, Pick Up, Where to Pick Up Food"
            }
          ]
        },
        {
          "next": "sendDelivery",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value matches_any_of 3, Food Delivery, Delivery",
              "arguments": [
                "{{widgets.askLearnAbout.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "3, Food Delivery, Delivery, Get Food Delivered"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.askLearnAbout.inbound.Body}}",
        "offset": {
          "x": -670,
          "y": 1480
        }
      }
    },
    {
      "name": "splitEnglish",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "errorEnglish",
          "event": "noMatch"
        },
        {
          "next": "languageEnglish",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "YES, Y",
              "arguments": [
                "{{widgets.sendIncomingEnglishWelcome.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "YES, Y"
            }
          ]
        },
        {
          "next": "askEnglishLanguage",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "NO",
              "arguments": [
                "{{widgets.sendIncomingEnglishWelcome.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "NO, N"
            }
          ]
        },
        {
          "next": "sendNoThanks",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to STOP",
              "arguments": [
                "{{widgets.sendIncomingEnglishWelcome.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "STOP"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.sendIncomingEnglishWelcome.inbound.Body}}",
        "offset": {
          "x": -380,
          "y": -100
        }
      }
    },
    {
      "name": "errorLearnAbout",
      "type": "send-message",
      "transitions": [
        {
          "next": "askLearnAbout",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1040,
          "y": 1220
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Sorry, that option is not currently supported. Please try again."
      }
    },
    {
      "name": "askBenefit",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "splitBenefit",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -670,
          "y": 1760
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Which benefit program would you like to learn more about?\n\nA. Supplemental Nutrition Assistance Program (SNAP)\nB. Women, Infants, and Children Nutrition Program (WIC)\nC. Healthy Incentive Program (HIP)\nD. Double Up Food Bucks Stores\n\nI can only respond to one option at a time, but we will be able to come back to these options later. Please respond with A, B, C, D, GO BACK or STOP.",
        "timeout": "3600"
      }
    },
    {
      "name": "splitBenefit",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "errorBenefit",
          "event": "noMatch"
        },
        {
          "next": "sendSNAP",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to A",
              "arguments": [
                "{{widgets.askBenefit.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "A"
            }
          ]
        },
        {
          "next": "sendWIC",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to B",
              "arguments": [
                "{{widgets.askBenefit.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "B"
            }
          ]
        },
        {
          "next": "sendHIP",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to C",
              "arguments": [
                "{{widgets.askBenefit.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "C"
            }
          ]
        },
        {
          "next": "sendDoubleUp",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to D",
              "arguments": [
                "{{widgets.askBenefit.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "D"
            }
          ]
        },
        {
          "next": "askLearnAbout",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to PREVIOUS MENU",
              "arguments": [
                "{{widgets.askBenefit.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "GO BACK"
            }
          ]
        },
        {
          "next": "sendNoThanks",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to STOP",
              "arguments": [
                "{{widgets.askBenefit.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "STOP"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.askBenefit.inbound.Body}}",
        "offset": {
          "x": -1180,
          "y": 1970
        }
      }
    },
    {
      "name": "askPickup",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "splitPickup",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -320,
          "y": 1760
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Are you looking to pick up affordable or free food? You can pick up free or affordable food at several locations throughout the City. \n\nA. Food Pantries (FREE)\nB. Farmers Markets (AFFORDABLE WITH SNAP + HIP)\nC. Youth Meal Sites (FREE)\nD. Fair Foods ($2 GROCERY BAGS)\nE. Mobile Farmers Market (AFFORDABLE WITH SNAP + HIP)\nF. Boston Double Up Food Bucks Stores (SNAP)\n\nRespond one of the following: A, B, C, D, E, F, PREVIOUS MENU, or STOP.",
        "timeout": "3600"
      }
    },
    {
      "name": "splitPickup",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "errorPickup",
          "event": "noMatch"
        },
        {
          "next": "sendFoodPantry",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to A",
              "arguments": [
                "{{widgets.askPickup.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "A"
            }
          ]
        },
        {
          "next": "sendFarmersMarket",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to B",
              "arguments": [
                "{{widgets.askPickup.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "B"
            }
          ]
        },
        {
          "next": "sendYouthMeals",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to C",
              "arguments": [
                "{{widgets.askPickup.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "C"
            }
          ]
        },
        {
          "next": "sendFairFoods",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to D",
              "arguments": [
                "{{widgets.askPickup.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "D"
            }
          ]
        },
        {
          "next": "sendFreshTruck",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to E",
              "arguments": [
                "{{widgets.askPickup.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "E"
            }
          ]
        },
        {
          "next": "sendDoubleUp",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to F",
              "arguments": [
                "{{widgets.askPickup.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "F"
            }
          ]
        },
        {
          "next": "askLearnAbout",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to PREVIOUS MENU",
              "arguments": [
                "{{widgets.askPickup.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "PREVIOUS MENU"
            }
          ]
        },
        {
          "next": "sendNoThanks",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to STOP",
              "arguments": [
                "{{widgets.askPickup.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "STOP"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.askPickup.inbound.Body}}",
        "offset": {
          "x": -200,
          "y": 1970
        }
      }
    },
    {
      "name": "sendDelivery",
      "type": "send-message",
      "transitions": [
        {
          "next": "askLearnMore",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": 780,
          "y": 1770
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Are you looking for affordable food deliveries? Check out these options.\n\nFRIDAY FOOD MARKET: Save money on produce and help reduce food waste by shopping excess produce sourced from food distributors around Boston. Receive your produce the next day by delivery for only $2. To order online, visit https://fridayfoodmarket.com/ .\n\nDAILY TABLE: Discounted produce and free deliveries within 2 miles of their stores. Use SNAP and Boston Double Up Food Bucks at their locations. To shop online visit https://dailytable.org/shop/ ."
      }
    },
    {
      "name": "askLearnMore",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "splitLearnmore",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": 1040,
          "y": 3030
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Would you like to learn about other food resources? Please respond YES or NO.",
        "timeout": "3600"
      }
    },
    {
      "name": "splitLearnmore",
      "type": "split-based-on",
      "transitions": [
        {
          "event": "noMatch"
        },
        {
          "next": "askLearnAbout",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value matches_any_of Yes, Y, Si",
              "arguments": [
                "{{widgets.askLearnMore.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "Yes, Y, Si"
            }
          ]
        },
        {
          "next": "sendNoThanks",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value matches_any_of No, N",
              "arguments": [
                "{{widgets.askLearnMore.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "No, N"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.askLearnMore.inbound.Body}}",
        "offset": {
          "x": 820,
          "y": 1210
        }
      }
    },
    {
      "name": "sendHIP",
      "type": "send-message",
      "transitions": [
        {
          "next": "askSNAP",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1010,
          "y": 2220
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "All SNAP beneficiaries can take part in HIP - no need to sign up. Spend your SNAP dollars on farm-fresh fruits and vegetables at participating retailers and have the amount of your purchase instantly added back to your EBT card!\n\nThe benefit will depend on the size of your household. \n\nFor 1-2 people you can earn up to $40 per month. \nFor 3-5 you can earn up to $60 per month. \nFor 6+ people you can earn up to $80 per month. \n\nFor more information, visit https://www.boston.gov/healthy-incentives/ ."
      }
    },
    {
      "name": "sendWIC",
      "type": "send-message",
      "transitions": [
        {
          "next": "askBenefit",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1360,
          "y": 2220
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "WIC is a nutrition program that provides healthy foods, nutrition education, breastfeeding support, and referrals to healthcare and other free services to families who qualify. You can apply online at https://www.mass.gov/forms/apply-for-wic-online/ or call at 1-800-942-1007 and 617-721-6601 weekdays Monday through Friday 9am – 5pm.\n\nIf you'd like to learn more about the program, visit https://www.mass.gov/wic-information-for-participants/ ."
      }
    },
    {
      "name": "sendDoubleUp",
      "type": "send-message",
      "transitions": [
        {
          "next": "askSNAP",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -680,
          "y": 2220
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Double Up Food Bucks Stores offer 50% discount on fruits and veggies to any SNAP shopper. You can save up to $10 each day. You can find a store near you at https://www.boston.gov/double-up/ ."
      }
    },
    {
      "name": "sendFoodPantry",
      "type": "send-message",
      "transitions": [
        {
          "next": "askPickup",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -330,
          "y": 2220
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Check out https://www.gbfb.org/need-food/ and search by zip code. Please call the pantry before you go to check for hours."
      }
    },
    {
      "name": "sendFarmersMarket",
      "type": "send-message",
      "transitions": [
        {
          "next": "askHIP",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": 0,
          "y": 2220
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Farmers Markets are now opening up and are affordable through benefit programs like SNAP and HIP. Visit https://www.boston.gov/farmers-markets/ to find a market near you."
      }
    },
    {
      "name": "sendYouthMeals",
      "type": "send-message",
      "transitions": [
        {
          "next": "askPickup",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": 340,
          "y": 2220
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "These sites offer breakfast and lunch to children and youth who are 18 and under. No ID is required to pick up a meal. To search locations, visit https://www.boston.gov/boston-eats/ . Please call the site before you go to check for hours"
      }
    },
    {
      "name": "askSNAP",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "splitSNAP",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -910,
          "y": 2530
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Would you like to get information on how to enroll in SNAP? Please respond YES or NO.",
        "timeout": "3600"
      }
    },
    {
      "name": "splitSNAP",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "errorSNAP",
          "event": "noMatch"
        },
        {
          "next": "sendSNAPEnroll",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to Y, Yes, Si",
              "arguments": [
                "{{widgets.askSNAP.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "Y, Yes, Si"
            }
          ]
        },
        {
          "next": "sendSNAPNoEnroll",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value matches_any_of N, No",
              "arguments": [
                "{{widgets.askSNAP.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "N, No"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.askSNAP.inbound.Body}}",
        "offset": {
          "x": -1000,
          "y": 2750
        }
      }
    },
    {
      "name": "askHIP",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "splitHIP",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": 20,
          "y": 2490
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Would you like to learn about the Healthy Incentives Program (HIP)?  Please respond YES, GO BACK, or STOP.",
        "timeout": "3600"
      }
    },
    {
      "name": "splitHIP",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "errorHIP",
          "event": "noMatch"
        },
        {
          "next": "sendHIP",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to Y, Yes, Si",
              "arguments": [
                "{{widgets.askHIP.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "Y, Yes, Si"
            }
          ]
        },
        {
          "next": "askPickup",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value matches_any_of N, No",
              "arguments": [
                "{{widgets.askHIP.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "Go Back, Go, Back"
            }
          ]
        },
        {
          "next": "sendNoThanks",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to Stop",
              "arguments": [
                "{{widgets.askHIP.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "Stop"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.askHIP.inbound.Body}}",
        "offset": {
          "x": -100,
          "y": 2750
        }
      }
    },
    {
      "name": "sendFairFoods",
      "type": "send-message",
      "transitions": [
        {
          "next": "askPickup",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": 690,
          "y": 2220
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Fair Foods sites offer bags of fresh produce for only $2. To search for locations near you visit https://www.bit.ly/fairfoods20/ ."
      }
    },
    {
      "name": "sendFreshTruck",
      "type": "send-message",
      "transitions": [
        {
          "next": "askHIP",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": 1040,
          "y": 2220
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "The Fresh Truck is a mobile farmers market. SNAP and HIP are available at their locations. To see their schedule visit https://www.aboutfresh.org/fresh-truck/#schedule/ ."
      }
    },
    {
      "name": "errorPickup",
      "type": "send-message",
      "transitions": [
        {
          "next": "askPickup",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": 960,
          "y": 1970
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Sorry, that option is not currently supported. Please try again."
      }
    },
    {
      "name": "errorBenefit",
      "type": "send-message",
      "transitions": [
        {
          "next": "askBenefit",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1550,
          "y": 1970
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Sorry, that option is not currently supported. Please try again."
      }
    },
    {
      "name": "errorSNAP",
      "type": "send-message",
      "transitions": [
        {
          "next": "askSNAP",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -1370,
          "y": 2760
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Sorry, that option is not currently supported. Please try again."
      }
    },
    {
      "name": "errorHIP",
      "type": "send-message",
      "transitions": [
        {
          "next": "askHIP",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -410,
          "y": 2540
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Sorry, that option is not currently supported. Please try again."
      }
    },
    {
      "name": "sendEnglishOutgoing",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "splitEnglishOutgoing",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": 3910,
          "y": -360
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Hi there, I'm Boston's Office of Food Access ChatBot. You completed an application for the Rental Relief Fund and gave the City of Boston permission to contact you via text. Would you like to learn about food resources available to you? Please respond YES or NO.",
        "timeout": "3600"
      }
    },
    {
      "name": "sendIncomingSpanishWelcome",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "splitSpanish",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": 2870,
          "y": -350
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Hola, soy el ChatBot de la Oficina de Acceso a Alimentos de Boston. Le gustaría continuar en español. Por favor responda SI, NO o ALTO.",
        "timeout": "3600"
      }
    },
    {
      "name": "splitFoodorComida",
      "type": "split-based-on",
      "transitions": [
        {
          "event": "noMatch"
        },
        {
          "next": "sendIncomingEnglishWelcome",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value matches_any_of FOOD",
              "arguments": [
                "{{trigger.message.Body}}"
              ],
              "type": "matches_any_of",
              "value": "FOOD, food"
            }
          ]
        },
        {
          "next": "sendIncomingSpanishWelcome",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value matches_any_of COMIDA",
              "arguments": [
                "{{trigger.message.Body}}"
              ],
              "type": "matches_any_of",
              "value": "COMIDA, comida"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{trigger.message.Body}}",
        "offset": {
          "x": 440,
          "y": -660
        }
      }
    },
    {
      "name": "splitAllLanguages",
      "type": "split-based-on",
      "transitions": [
        {
          "event": "noMatch"
        },
        {
          "next": "askLearnAbout",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "ENG",
              "arguments": [
                "{{widgets.askEnglishLanguage.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "1, ENG, English"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.askEnglishLanguage.inbound.Body}}",
        "offset": {
          "x": 1530,
          "y": 540
        }
      }
    },
    {
      "name": "errorSpanish",
      "type": "send-message",
      "transitions": [
        {
          "next": "sendIncomingSpanishWelcome",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": 2400,
          "y": -60
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Lo sentimos, esa opción no está soportada actualmente. Por favor, inténtalo de nuevo."
      }
    },
    {
      "name": "splitSpanish",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "errorSpanish",
          "event": "noMatch"
        },
        {
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to SI",
              "arguments": [
                "{{widgets.sendIncomingSpanishWelcome.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "SI"
            }
          ]
        },
        {
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to NO",
              "arguments": [
                "{{widgets.sendIncomingSpanishWelcome.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "NO, N"
            }
          ]
        },
        {
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to ALTO",
              "arguments": [
                "{{widgets.sendIncomingSpanishWelcome.inbound.Body}}"
              ],
              "type": "equal_to",
              "value": "ALTO"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.sendIncomingSpanishWelcome.inbound.Body}}",
        "offset": {
          "x": 2890,
          "y": -70
        }
      }
    },
    {
      "name": "splitEnglishOutgoing",
      "type": "split-based-on",
      "transitions": [
        {
          "event": "noMatch"
        },
        {
          "event": "match",
          "conditions": [
            {
              "friendly_name": "YES, Y",
              "arguments": [
                "{{widgets.sendIncomingEnglishWelcome.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "YES, Y"
            }
          ]
        },
        {
          "event": "match",
          "conditions": [
            {
              "friendly_name": "NO",
              "arguments": [
                "{{widgets.sendIncomingEnglishWelcome.inbound.Body}}"
              ],
              "type": "matches_any_of",
              "value": "NO, N"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.sendIncomingEnglishWelcome.inbound.Body}}",
        "offset": {
          "x": 3920,
          "y": -60
        }
      }
    },
    {
      "name": "sendSNAP",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "splitSNAP",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -1720,
          "y": 2230
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "SNAP provides nutrition benefits to supplement the food budget of needy families so they can purchase healthy food and move towards self-sufficiency.\n\nWould you like to get information on how to enroll on SNAP? Please respond YES or NO.",
        "timeout": "3600"
      }
    },
    {
      "name": "sendSNAPEnroll",
      "type": "send-message",
      "transitions": [
        {
          "next": "askLearnMore",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -990,
          "y": 3010
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "You can text \"Food\" to 74544* to apply with mRelief, or call Project Bread at 1-800-645-8333 for support in 150 languages.\n\nFor more information, vist https://www.mass.gov/snap-benefits-formerly-food-stamps."
      }
    },
    {
      "name": "sendSNAPNoEnroll",
      "type": "send-message",
      "transitions": [
        {
          "next": "askLearnMore",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -640,
          "y": 3010
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "No problem. If you have questions regarding the program, visit https://www.mass.gov/snap-benefits-formerly-food-stamps/ or call Project Bread at 1-800-645-8333. They can help you answer questions in 150 languages."
      }
    }
  ],
  "initial_state": "Trigger",
  "flags": {
    "allow_concurrent_calls": true
  }
}
